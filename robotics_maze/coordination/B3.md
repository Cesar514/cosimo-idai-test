# B3 Progress Log (PyBullet Sim + Robot Control)

## Scope Completed

- Implemented `robotics_maze/src/sim.py` as a PyBullet simulation wrapper with:
  - `GUI` or `DIRECT` runtime mode.
  - world configuration (gravity, timestep, plane setup).
  - robot loading API with default preference order: `husky` then `r2d2` fallback.
  - 3D maze wall spawning from obstacle-box definitions (center/size plus optional yaw/color/mass).
  - waypoint assignment, stepping, run-until-goal loop, and goal-reached detection.
  - goal-reached reset hook (`set_reset_environment_hook`) and `reset_environment(...)` entry point.
  - CLI adapter `create_simulator()` with `run_episode(maze, plan, gui, seed)` interface.

- Implemented `robotics_maze/src/robot.py` with:
  - `MobileRobotController` path-following controller for waypoint execution.
  - heading-aware linear/angular velocity command generation.
  - PyBullet base-velocity actuation plus optional wheel joint spin for visible motion.
  - waypoint progression and final-goal arrival signaling.

## Interfaces Added

- `PyBulletMazeSim(gui=False, time_step=..., gravity=..., reset_environment_hook=None)`
- `PyBulletMazeSim.load_mobile_robot(...)`
- `PyBulletMazeSim.spawn_maze_walls(obstacles)`
- `PyBulletMazeSim.set_waypoints(waypoints)`
- `PyBulletMazeSim.step(...)`
- `PyBulletMazeSim.run_until_goal(...)`
- `PyBulletMazeSim.reset_environment(...)`
- `PyBulletMazeSim.set_reset_environment_hook(...)`
- `create_simulator(...) -> MazeEpisodeSimulator`
- `MazeEpisodeSimulator.run_episode(maze, plan, gui, seed) -> EpisodeResult`

- `PathFollowerConfig(...)`
- `MobileRobotController.set_waypoints(...)`
- `MobileRobotController.step_path_follow()`
- `MobileRobotController.distance_to_goal()`

## Notes for Integration

- Obstacle definitions accepted as:
  - `ObstacleBox(center=(x, y, z), size=(sx, sy, sz), ...)`, or
  - dicts with `center`/`size` (or aliases), or
  - dicts with scalar `x,y,z,width,depth,height`.
- Goal detection occurs when final waypoint enters tolerance; optional reset hook is called exactly when that transition happens.
